<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="divvy">
<title>Environmental and geographic standardisation case study • divvy</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Environmental and geographic standardisation case study">
<meta property="og:description" content="divvy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">divvy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/subsampling-vignette.html">Subsampling tutorial</a>
    <a class="dropdown-item" href="../articles/habitat-rangesize-case-study.html">Range size case study</a>
    <a class="dropdown-item" href="../articles/subsampling-concept-walkthrough.html">Conceptual walkthrough</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GawainAntell/divvy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Environmental and geographic standardisation case study</h1>
                        <h4 data-toc-skip class="author">G. T.
Antell</h4>
            
            <h4 data-toc-skip class="date">24 October 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GawainAntell/divvy/blob/HEAD/vignettes/habitat-rangesize-case-study.Rmd" class="external-link"><code>vignettes/habitat-rangesize-case-study.Rmd</code></a></small>
      <div class="d-none name"><code>habitat-rangesize-case-study.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="goals-and-limitations-of-the-vignette">Goals and limitations of the vignette<a class="anchor" aria-label="anchor" href="#goals-and-limitations-of-the-vignette"></a>
</h2>
<p>This vignette is written to model a realistic project flow for
ecological occurrence data, providing example uses of <code>divvy</code>
functions in <code>R</code> code chunks to analyse geographic range size
disparities between comparison categories. The data and hypothesis are
representative of many real palaeobiology studies, with the hope of
serving as a template for comparing ecology between environments,
regions, or clades—for instance, investigations about whether diversity
was greater in Gondwanaland or Laurasia, or whether biogeographic
connectedness was greater within reefal or non-reefal assemblages.</p>
<p>Results herein should not be taken as a conclusive answer to the
example research question. For a publication-quality study, ideally one
would further vet both taxonomic and environmental assignments in the
original public database download, for instance. Similarly, while this
vignette illustrates two lines of analysis, additional follow-up
inquiries would be prudent to pursue before arguing a definitive
palaeoecological interpretation of the results to the research
community.</p>
<p>The vignette consists of the following parts:</p>
<ol style="list-style-type: decimal">
<li>Background on example research question</li>
<li>Formatting point occurrence data</li>
<li>Developing environmental categories (raster data)</li>
<li>Categorising taxon preferences for environments</li>
<li>Spatial subsampling to regions of equal area and dispersion</li>
<li>Hypothesis testing of assemblage-based range-size metric</li>
<li>Hypothesis testing of per-taxon range-size metrics</li>
<li>References</li>
</ol>
</div>
<div class="section level2">
<h2 id="background-on-geographic-ranges-between-marine-environments">Background on geographic ranges between marine environments<a class="anchor" aria-label="anchor" href="#background-on-geographic-ranges-between-marine-environments"></a>
</h2>
<p>Palaeobiologists often track ecological parameters through time,
where, as the main <code>divvy</code> package vignette illustrates, it
is crucial to standardise differences in spatial coverage between time
steps. However, it is equally important to apply spatial standardisation
for comparisons between environment or habitat types, even if data occur
within one time step. For instance, consider two habitat types that
cover different geographic extents. To determine fairly which habitat
hosts more diverse communities, one must account for the difference in
spatial coverage. By first subsampling each habitat type into equivalent
spatial units, one can then directly and fairly compare richness or
other ecological metrics between environments.</p>
<p>In the marine realm, one of the most important environmental axes of
ecological differentiation is water depth. Diversity, geographic range
size, and other aspects of community structure vary along a gradient of
near-shore to deep-water environments. Here, we divide this
environmental spectrum coarsely into shallow (proximal) vs. deep
(distal) marine habitats. ‘Shallow’ habitats encompass deltaic,
(sub)tidal, and shelf margin environments. ‘Deep’ habitats include
continental slope and offshore settings, generally beginning at 140 m
<span class="citation">(Durán and Guillén 2018)</span>.</p>
<p>The ecological attribute this case study focusses on is geographic
range size, a trait with widespread importance. For instance, range size
determines extinction risk to a large degree <span class="citation">(Harnik, Simpson, and Payne 2012; Saupe et al.
2015)</span>. Range size might influence origination propensity as well,
although researchers dispute whether this relationship is positive <span class="citation">(Rosenzweig 1995; Maurer and Nott 2001)</span>,
negative <span class="citation">(Hansen 1980; Jablonski and Roy
2003)</span>, or unimodal <span class="citation">(Gaston 2003; Allmon
and Martin 2014)</span>.</p>
<p>The environmental niche breadth of a taxon strongly controls its
geographic distribution; the maximum attainable extent of a taxon’s
range size is the extent of occurrence of that taxon’s suitable habitat.
Two consequences of this relationship are that (1) taxa with broad
niches (generalists or eurytopic taxa) are expected to occupy larger
ranges than those with narrow niches (specialists or stenotopic taxa),
and (2) for environments within a given specialisation, a larger
geographic distribution of those habitats permits taxa to occupy larger
ranges. Taxa may be more restricted than suitable environmental
conditions would predict (realised niche breadth), due to biotic or
historic factors, but taxa cannot exceed the bounds set by environmental
suitability. Since environmental characteristics are more homogeneous in
the cold, dark waters of the deep sea than in the topologic complexity
of shallow settings, ecologists have long theorised geographic ranges to
be larger for deep-dwelling than shallow-water species <span class="citation">(Coe 1946; McClain and Hardy 2010; Costello and
Chaudhary 2017)</span>. Most empirical tests of this hypothesis have
relied upon modern data, however, with relatively little evidence from
periods of Earth history when ocean circulation and continental
configuration were entirely unlike those of today.</p>
<p><a id="atlas_map"></a> The following sections walk through an
analysis to test the expectations geographic ranges are wider for (1)
eurytopic than stenotopic taxa and (2) deep- than shallow-water taxa,
using brachiopod occurrences from the Silurian (444-419 Ma) recorded in
the <a href="https://paleobiodb.org/" class="external-link">Paleobiology Database</a> (PBDB).
Brachiopoda was a diverse clade that made up a large component of
Paleozoic benthic communities <span class="citation">(Close et al. 2020;
Rojas et al. 2021)</span>. In the Paleozoic, much of the world’s
landmass had coalesced at southermost latitudes into Gondwanaland, with
the remaining continents scattered at the equator and separated by the
Iapetus, Paleo-Tethys, Rheic, and Panthalassic oceans (map below).
Hence, the geometry of a cosmopolitan marine species’ range from the
Silurian would differ distinctly from a cosmopolitan range today.
Spatial subsampling is crucial to addressing the research questions
because the preserved area and distribution of shallow and deep-water
habitats also differ from each other.</p>
<div class="figure">
<img src="PALEOMAP_atlas_map75a_Llandovery_430.png" alt=""><p class="caption"><em>Silurian palaeogeography, as reconstructed by the
PALEOMAP PaleoAtlas project <span class="citation">(Scotese
2016)</span>.</em></p>
</div>
</div>
<div class="section level2">
<h2 id="prepare-taxonomic-occurrence-data">Prepare taxonomic occurrence data<a class="anchor" aria-label="anchor" href="#prepare-taxonomic-occurrence-data"></a>
</h2>
<p>PBDB downloads of (1) all marine collections and (2) all Brachiopoda
occurrences with accepted names at genus-ranking or below are available
as attached datasets in the <code>divvy</code> package. Both datasets
are subset to relevant columns and are cleaned to remove records missing
coordinates. For more information, load the package and query the data
objects from the console with <code><a href="../reference/collSilur.html">?collSilur</a></code> and
<code><a href="../reference/occSilur.html">?occSilur</a></code>. The script to download and vet the raw data is
available as <code>format-data.R</code> within the GitHub repository <a href="https://github.com/GawainAntell/divvy/tree/main/data-raw" class="external-link">data-raw
folder (link)</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># terra and sf have all the necessary helper functions for spatial operations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gawainantell.github.io/divvy/">divvy</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">collSilur</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">)</span></span></code></pre></div>
<p>The taxonomic hierarchy and stratigraphic ranges of the occurrence
data are standardised against the Sepkoski Compendium already, following
the <code>fossilbrush</code> package vignette <span class="citation">(Flannery-Sutherland et al. 2022)</span>. A further
element of cleaning is removal of taxa that occur only once (‘space-time
singletons’ <em>sensu</em> <span class="citation">Antell et al.
(2020)</span>). These records contain insufficient information to
contribute to geographic range-size calculations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmFreq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="va">sss</span> <span class="op">&lt;-</span> <span class="va">nmFreq</span><span class="op">[</span><span class="va">nmFreq</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sssRows</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">genus</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">sss</span></span>
<span><span class="va">occSilur</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">[</span> <span class="op">!</span><span class="va">sssRows</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sss</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 52</span></span></code></pre>
<p>This step removes 52 taxa with singular occurrence records.</p>
<p>To disregard trivial differences in coordinate values between points
from the same or adjacent localities, the next data treatment is
conversion of vector (point) data to raster grid cells. For each PBDB
record, the ID and centroid coordinates of its encompassing raster cell
are saved in new columns. These cell values will be used in spatial
calculations later to improve computation time substantially compared to
operations on vector point data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initialise Equal Earth projected coordinates</span></span>
<span><span class="va">rWorld</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">prj</span> <span class="op">&lt;-</span> <span class="st">'EPSG:8857'</span></span>
<span><span class="va">rPrj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">rWorld</span>, <span class="va">prj</span>, res <span class="op">=</span> <span class="fl">200000</span><span class="op">)</span> <span class="co"># 200,000m is approximately 2 degrees</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">rPrj</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">rPrj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># coordinate column names for the current and target coordinate reference system</span></span>
<span><span class="va">xyCartes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'paleolng'</span>,<span class="st">'paleolat'</span><span class="op">)</span></span>
<span><span class="va">xyCell</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cellX'</span>,<span class="st">'cellY'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># collection data</span></span>
<span><span class="va">llColl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">collSilur</span>, geom <span class="op">=</span> <span class="va">xyCartes</span>, crs <span class="op">=</span> <span class="st">'epsg:4326'</span><span class="op">)</span></span>
<span><span class="va">prjColl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">llColl</span>, <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">collSilur</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/cells.html" class="external-link">cells</a></span><span class="op">(</span><span class="va">rPrj</span>, <span class="va">prjColl</span><span class="op">)</span><span class="op">[</span>,<span class="st">'cell'</span><span class="op">]</span></span>
<span><span class="va">collSilur</span><span class="op">[</span>, <span class="va">xyCell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">rPrj</span>, <span class="va">collSilur</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># taxon occurrences</span></span>
<span><span class="va">llOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">occSilur</span>, geom <span class="op">=</span> <span class="va">xyCartes</span>, crs <span class="op">=</span> <span class="st">'epsg:4326'</span><span class="op">)</span></span>
<span><span class="va">prjOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">llOccs</span>, <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">occSilur</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/cells.html" class="external-link">cells</a></span><span class="op">(</span><span class="va">rPrj</span>, <span class="va">prjOccs</span><span class="op">)</span><span class="op">[</span>,<span class="st">'cell'</span><span class="op">]</span></span>
<span><span class="va">occSilur</span><span class="op">[</span>, <span class="va">xyCell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">rPrj</span>, <span class="va">occSilur</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="categorise-environment-associated-with-occurrences">Categorise environment associated with occurrences<a class="anchor" aria-label="anchor" href="#categorise-environment-associated-with-occurrences"></a>
</h2>
<p>To compare ecological parameters between preferred environments, the
23 categories in the PBDB <code>environment</code> field must first be
reclassified as a binary variable for proximal and deep-water settings.
The following division of marine environments is copied from scripts of
<span class="citation">Antell et al. (2020)</span>, who adapted the
classification of <span class="citation">Nürnberg and Aberhan
(2013)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proxTerms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coastal indet."</span>, <span class="st">"delta front"</span>, <span class="st">"delta plain"</span>,</span>
<span>               <span class="st">"deltaic indet."</span>, <span class="st">"estuary/bay"</span>, <span class="st">"foreshore"</span>, <span class="st">"interdistributary bay"</span>,</span>
<span>               <span class="st">"lagoonal"</span>, <span class="st">"lagoonal/restricted shallow subtidal"</span>,</span>
<span>               <span class="st">"marginal marine indet."</span>, <span class="st">"open shallow subtidal"</span>,</span>
<span>               <span class="st">"fluvial-deltaic indet."</span>, <span class="st">"paralic indet."</span>,</span>
<span>               <span class="st">"peritidal"</span>, <span class="st">"prodelta"</span>, <span class="st">"sand shoal"</span>,</span>
<span>               <span class="st">"shallow subtidal indet."</span>, <span class="st">"shoreface"</span>,</span>
<span>               <span class="st">"transition zone/lower shoreface"</span>,</span>
<span>               <span class="st">"intrashelf/intraplatform reef"</span>, <span class="st">"reef, buildup or bioherm"</span>,</span>
<span>               <span class="st">"perireef or subreef"</span>, <span class="st">"platform/shelf-margin reef"</span><span class="op">)</span></span>
<span><span class="va">deepTerms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basinal (carbonate)"</span>, <span class="st">"basinal (siliceous)"</span>,</span>
<span>               <span class="st">"basinal (siliciclastic)"</span>, <span class="st">"deep-water indet."</span>,</span>
<span>               <span class="st">"deep subtidal indet."</span>, <span class="st">"deep subtidal ramp"</span>,</span>
<span>               <span class="st">"deep subtidal shelf"</span>, <span class="st">"offshore"</span>, <span class="st">"offshore indet."</span>,</span>
<span>               <span class="st">"offshore shelf"</span>, <span class="st">"slope"</span>, <span class="st">"submarine fan"</span>, <span class="st">"offshore ramp"</span>,</span>
<span>               <span class="st">"basin reef"</span>, <span class="st">"slope/ramp reef"</span><span class="op">)</span></span></code></pre></div>
<p>The most accurate environmental information will be that associated
directly with occurrence records. Where available, that is the
information this script will prioritise. However, there are many
instances of a blank or indeterminate <code>environment</code> field. In
those cases, a way to infer probable environment is to determine the
predominant environment in the local grid cell based on the environment
recorded from any PBDB collections in that cell. A collection in the
PBDB can contain any number of occurrences of any number of clades but
is tied to a point coordinate—therefore, collections are a rich source
of environmental data that is largely independent of occurrences for an
individual clade.</p>
<p><code>divvy</code> provides the <code><a href="../reference/classRast.html">classRast()</a></code> function to
convert environmental occurrence points to a raster grid with a dominant
environmental class in each cell. In the use below, the function
classifies grid cells as proximal or deep-water whenever more than 80%
of collections are affiliated with a single environment. The template
raster passed to <code><a href="../reference/classRast.html">classRast()</a></code> here has the same resolution,
extent, and coordinate reference system as applied above to the
occurrence data. <a id="raster_map"></a></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collSilur</span><span class="op">$</span><span class="va">bath</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">collSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">[</span><span class="va">collSilur</span><span class="op">$</span><span class="va">environment</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">proxTerms</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'prox'</span></span>
<span><span class="va">collSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">[</span><span class="va">collSilur</span><span class="op">$</span><span class="va">environment</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">deepTerms</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'deep'</span></span>
<span><span class="va">bathRast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classRast.html">classRast</a></span><span class="op">(</span><span class="va">rPrj</span>, dat <span class="op">=</span> <span class="va">collSilur</span>, cutoff <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                      xy <span class="op">=</span> <span class="va">xyCell</span>, env <span class="op">=</span> <span class="st">'bath'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bathRast</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#1B9E77"</span>, <span class="st">"#D95F02"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="classify-collections-enviro-1.png" alt="World map where a mix of grid cells labelled deep, shallow, and indeterminate are scattered around the outline of Gondwanaland and Laurasia. Most of the points fall close to the coastlines and are concentrated around Laurasia." width="650" height="325"><p class="caption">
<em>Predominant environment recorded in PBDB collections</em>
</p>
</div>
<p>A plot of the environmental distribution inferred from collection
data traces the mid-latitude continents <a href="#atlas_map">(figured
above)</a>, albeit with gaps. Very few occurrences appear along the
coasts of Gondwanaland, perhaps largely due to the under-sampling and
under-reporting of the corresponding modern continents relative to North
America and Europe. Also note that sampling of northern extents of
Laurasia occurs almost exclusively in deep-water settings.</p>
<p>It is now possible to infer binary water depth for brachiopod
occurrence records. Where available, the classification will reflect the
environment directly associated with occurrences, and otherwise will be
inferences from the collections-based raster.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new 'bathCell' column to note the collections-inferred environment</span></span>
<span><span class="va">occSilur</span><span class="op">$</span><span class="va">bathCell</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">bathRast</span>, <span class="va">prjOccs</span><span class="op">)</span><span class="op">[[</span><span class="st">'mainClass'</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># refine the enviro where possible based on observations directly linked to occs</span></span>
<span><span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">[</span><span class="va">occSilur</span><span class="op">$</span><span class="va">environment</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">proxTerms</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'prox'</span></span>
<span><span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">[</span><span class="va">occSilur</span><span class="op">$</span><span class="va">environment</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">deepTerms</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'deep'</span></span></code></pre></div>
<p>A quick inspection reveals roughly equal numbers of occurrences in
each environment. However, there are half again as many shallow as
deep-water grid cells as indicated by all marine collections—a result
that points to the necessity of subsampling. Without accounting for the
greater observation of proximal habitats, if shallow-water specialists
turn out to have equal or larger geographic occupancies than deep-water
specialists it might be impossible to tell if this result is due purely
to sampling or also to ecology.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">)</span> <span class="co"># environment inferred directly from records</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   deep   prox indet. </span></span>
<span><span class="co">#&gt;   4966   4124   2035</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/freq.html" class="external-link">freq</a></span><span class="op">(</span><span class="va">bathRast</span>, bylayer <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    value count</span></span>
<span><span class="co">#&gt; 1   deep   141</span></span>
<span><span class="co">#&gt; 2   prox   226</span></span>
<span><span class="co">#&gt; 3 indet.    70</span></span></code></pre>
<p>Inspection also reveals the majority of environments inferred from
collection data nearby do match the environments associated with
occurrence records directly. Most of the discrepancies occur when
collection-derived environment was indeterminate and occurrence data
contained specific environment terms.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what proportion of environments associated with individual records</span></span>
<span><span class="co"># match environmental inferences from nearby collections' data?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span> <span class="op">==</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">bathCell</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.6516729</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare number of indeterminate enviro from collections vs above from records</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">bathCell</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   deep   prox indet. </span></span>
<span><span class="co">#&gt;   3616   3330   4158</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="assign-per-taxon-environmental-preferences">Assign per-taxon environmental preferences<a class="anchor" aria-label="anchor" href="#assign-per-taxon-environmental-preferences"></a>
</h2>
<p>Now that the data are standardised to the same raster gridding and
environmental classification, it is possible to infer the environmental
preferences and niche breadth of all taxa. The custom function below
labels a focal taxon as a specialist for an environment if more than a
threshold proportion of its occurrences (here, 70%) lie within a single
habitat type.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># categorise preferences as binary or nonspecific/eurytopic</span></span>
<span><span class="va">pref</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">env</span>, <span class="va">cutoff</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">envTbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="st">'unk'</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">envTbl</span> <span class="op">&lt;-</span> <span class="va">envTbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># proportional enviro abundance</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">cutoff</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># check if either envrio is predominant</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">cutoff</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envTbl</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="st">'both'</span> <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># The bathymetry column of occurrences is an ordered factor, so levels</span></span>
<span><span class="co"># 1 and 2 subset by the function correspond to the two environment types</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "deep"   "prox"   "indet."</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tag each row as from a taxon with deep, proximal, or eurytopic preference</span></span>
<span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">occSilur</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="va">occSilur</span><span class="op">$</span><span class="va">pref</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">tax</span> <span class="kw">in</span> <span class="va">taxa</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="va">taxBool</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">genus</span> <span class="op">==</span> <span class="va">tax</span></span>
<span> <span class="va">envOccs</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">bath</span><span class="op">[</span><span class="va">taxBool</span><span class="op">]</span></span>
<span> <span class="va">occSilur</span><span class="op">$</span><span class="va">pref</span><span class="op">[</span><span class="va">taxBool</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">pref</span><span class="op">(</span><span class="va">envOccs</span>, <span class="va">cutoff</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A simple way to split the data into comparison groups used in
analysis below is to divide the occurrence dataset into three
<code>data.frame</code>s: one for deep-water specialists, one for
proximal-environment specialists, and one for eurytopic taxa with
respect to depth. This data structure is straightforward to illustrate
subsampling in the section below but is not the only way to proceed with
analysis; for instance, one could organise the data subsets in a
<code>list</code> or <code>array</code> instead, and then perform
subsampling across that structure’s indices.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deep</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">[</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">pref</span> <span class="op">==</span> <span class="st">'deep'</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/uniqify.html">uniqify</a></span><span class="op">(</span>taxVar <span class="op">=</span> <span class="st">'genus'</span>, xy <span class="op">=</span> <span class="va">xyCell</span><span class="op">)</span></span>
<span><span class="va">prox</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">[</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">pref</span> <span class="op">==</span> <span class="st">'prox'</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/uniqify.html">uniqify</a></span><span class="op">(</span>taxVar <span class="op">=</span> <span class="st">'genus'</span>, xy <span class="op">=</span> <span class="va">xyCell</span><span class="op">)</span></span>
<span><span class="va">eury</span> <span class="op">&lt;-</span> <span class="va">occSilur</span><span class="op">[</span> <span class="va">occSilur</span><span class="op">$</span><span class="va">pref</span> <span class="op">==</span> <span class="st">'both'</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/uniqify.html">uniqify</a></span><span class="op">(</span>taxVar <span class="op">=</span> <span class="st">'genus'</span>, xy <span class="op">=</span> <span class="va">xyCell</span><span class="op">)</span></span>
<span><span class="co"># the divvy uniqify() function removes duplicate taxon-cell combinations</span></span>
<span><span class="co"># for smaller memory use and faster calculations below</span></span>
<span></span>
<span><span class="co"># how many taxa specialise in each?</span></span>
<span><span class="va">taxaD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">deep</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="va">taxaP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">prox</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="va">taxaE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">eury</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxaD</span><span class="op">)</span>, <span class="st">'deep;'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxaP</span><span class="op">)</span>, <span class="st">'shallow;'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxaE</span><span class="op">)</span>, <span class="st">'both'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "94 deep; 61 shallow; 100 both"</span></span></code></pre>
<p>The 70% threshold used to define taxon affinities leads to
approximately equal numbers of deep and eurytopic taxa and a smaller
sample of proximal specialists.</p>
</div>
<div class="section level2">
<h2 id="spatially-subsample-each-environment">Spatially subsample each environment<a class="anchor" aria-label="anchor" href="#spatially-subsample-each-environment"></a>
</h2>
<p>It is now an appropriate point in the workflow to standardise the
spatial coverage of occurrences in each comparison group.
<code>divvy</code> provides several options of spatial subsampling
functions; in the code chunk below, we apply the <code><a href="../reference/cookies.html">cookies()</a></code>
subsampling routine to the datasets of deep, proximal, and eurytopic
taxa. The arguments <code>reps</code>, <code>siteQuota</code>, and
<code>radius</code> define the number of subsampling iterations run, the
number of localities to include in each subsample, and the maximum
radius of each circular subsampling region, respectively.</p>
<p>The value of <code>reps</code> is set at a number high enough to
ensure all possible points are captured in at least one subsample, while
keeping the returned object (list of subsampled
<code>data.frame</code>s) at a manageable size. Increasing the number of
<code>reps</code> only slightly prolongs the computational time of
subsampling but will linearly slow the runtime of range-size
calculations on subsamples in the following sections. In Phanerozoic
analyses, <span class="citation">Antell et al. (2020)</span> performed
500 replicates of circular subsampling per time step, and <span class="citation">Close et al. (2017)</span> did 100 (20 replicates from
each of 5 regions defined by minimum spanning trees).</p>
<p>The values of <code>siteQuota</code> and <code>radius</code> are a
trade-off between increasing the sample size of localities within each
subsample to precisely characterise geographic ranges while limiting the
total extent of the subsampling region not to exceed the approximate
size of an ocean basin or biogeographic zone.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reps</span> <span class="op">&lt;-</span> <span class="fl">500</span> <span class="co"># number of subsamples to draw</span></span>
<span><span class="va">siteQuota</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># number of sites (equal-area grid cells) in each subsample</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># radial distance in km</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">sampD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cookies.html">cookies</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">deep</span>,</span>
<span>                 xy <span class="op">=</span> <span class="va">xyCell</span>, iter <span class="op">=</span> <span class="va">reps</span>,</span>
<span>                 nSite <span class="op">=</span> <span class="va">siteQuota</span>,</span>
<span>                 r <span class="op">=</span> <span class="va">r</span>, weight <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 crs <span class="op">=</span> <span class="va">prj</span>, output <span class="op">=</span> <span class="st">'full'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">sampP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cookies.html">cookies</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">prox</span>,</span>
<span>                 xy <span class="op">=</span> <span class="va">xyCell</span>, iter <span class="op">=</span> <span class="va">reps</span>,</span>
<span>                 nSite <span class="op">=</span> <span class="va">siteQuota</span>,</span>
<span>                 r <span class="op">=</span> <span class="va">r</span>, weight <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 crs <span class="op">=</span> <span class="va">prj</span>, output <span class="op">=</span> <span class="st">'full'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">sampE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cookies.html">cookies</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">eury</span>,</span>
<span>                 xy <span class="op">=</span> <span class="va">xyCell</span>, iter <span class="op">=</span> <span class="va">reps</span>,</span>
<span>                 nSite <span class="op">=</span> <span class="va">siteQuota</span>,</span>
<span>                 r <span class="op">=</span> <span class="va">r</span>, weight <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 crs <span class="op">=</span> <span class="va">prj</span>, output <span class="op">=</span> <span class="st">'full'</span><span class="op">)</span></span></code></pre></div>
<p>For further details of subsampling using <code>divvy</code>,
including the <code><a href="../reference/clustr.html">clustr()</a></code> function to define subsamples based
on minimum spanning tree diameter instead of circular regional
constraints, consult the other vignettes and <span class="citation">Antell, Benson, and Saupe (accepted)</span>.</p>
</div>
<div class="section level2">
<h2 id="summed-common-occurrence-rate-between-environments">Summed Common Occurrence Rate between environments<a class="anchor" aria-label="anchor" href="#summed-common-occurrence-rate-between-environments"></a>
</h2>
<p>We need to parameterise geographic range sizes in some way to make
quantitative comparisons between ecological groups. One way to do so is
with a measure of cosmopolitanism calculated on assemblage-level data
(rather than individual taxa), such as the Summed Common species/taxon
Occurrence Rate (SCOR). SCOR reflects the degree to which taxa are
common/widespread and is decoupled from richness or abundance <span class="citation">(Hannisdal, Henderiks, and Liow 2012)</span>.
<code>divvy</code> provides the <code><a href="../reference/sdSumry.html">sdSumry()</a></code> function to
compute summary statistics about the geographic coverage and diversity
of a dataset, including SCOR; conveniently, <code><a href="../reference/sdSumry.html">sdSumry()</a></code> can
take a <code>list</code> of subsampled occurrence data subsets as its
data argument and return a single <code>data.frame</code> with columns
for the summary variables and a row for each subsample.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metaD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">sampD</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">metaP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">sampP</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">metaE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">sampE</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span></span></code></pre></div>
<p>SCOR is calculated as the sum across taxa of the log probability of
incidence: very widespread taxa make a large contribution to an
assemblage SCOR, while rare taxa have relatively little influence. When
a taxon is present in <em>all</em> sampled locations, its log
probability of incidence is infinite. Infinity is nonsensical in an
empirical comparison, so let’s screen out subsamples with those values
(12 in total, of 1500 subsamples).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check for infinity values of SCOR and remove them</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">metaD</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># none in deep habitat dataset</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">metaP</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># but some in the prox habitat dataset</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">metaE</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># and some in the all-habitats dataset</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">metaP</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span></span>
<span><span class="va">metaP</span> <span class="op">&lt;-</span> <span class="va">metaP</span><span class="op">[</span> <span class="op">!</span><span class="va">infP</span>, <span class="op">]</span></span>
<span><span class="va">infE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">metaE</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span></span>
<span><span class="va">metaE</span> <span class="op">&lt;-</span> <span class="va">metaE</span><span class="op">[</span> <span class="op">!</span><span class="va">infE</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infP</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">infE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 2</span></span></code></pre>
<p>For the permutation hypothesis tests below, it would be ideal for
comparison groups to match in sample size. The previous step removed 10
samples from one group, 2 from another, and none from the third—a
difference that could be remedied by omitting another 8 and 10 samples
from the latter two groups, respectively. Samples could be selected at
random. However, one could argue it would unfairly increase the odds of
supporting the hypothesis of larger ranges in deep than shallow habitats
to randomly omit 10 deep samples but selectively omit the 10 shallow
samples where at least one taxon was universally distributed. For a
conservative comparison, one could instead omit deep and eurytopic
samples with largest values of SCOR.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make sample size (of subsamples) equal, by removing ones with largest SCOR</span></span>
<span><span class="va">lowestN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metaD</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metaP</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">metaE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sortD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">metaD</span><span class="op">$</span><span class="va">SCOR</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">metaD</span> <span class="op">&lt;-</span> <span class="va">metaD</span><span class="op">[</span><span class="va">sortD</span>, <span class="op">]</span></span>
<span><span class="va">metaD</span> <span class="op">&lt;-</span> <span class="va">metaD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">lowestN</span>, <span class="op">]</span></span>
<span><span class="va">sortE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">metaE</span><span class="op">$</span><span class="va">SCOR</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">metaE</span> <span class="op">&lt;-</span> <span class="va">metaE</span><span class="op">[</span><span class="va">sortE</span>, <span class="op">]</span></span>
<span><span class="va">metaE</span> <span class="op">&lt;-</span> <span class="va">metaE</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">lowestN</span>, <span class="op">]</span></span></code></pre></div>
<p>Ultimately, the choice of how to perform this selection step makes
little difference to results, because it affects only 2% of
subsamples.</p>
<p>At last we can compare the degree to which taxa of each ecological
group are widespread, within normalised amounts of habitat. There are
various test statistics one could calculate. Here are custom functions
for a bootstrapping approach that capitalises on the existing division
of subsamples to generate nonparametric estimates of how probable SCOR
values from one group are to exceed those of another.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># how often does the value in group 1 exceed that in group 2 paired samples?</span></span>
<span><span class="co"># randomly shuffle subsample ordering before comparing</span></span>
<span><span class="va">testDiff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span>, <span class="va">vTest</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">)</span></span>
<span>  <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat2</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">h1obs</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span>, <span class="va">vTest</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">dat2</span><span class="op">[</span>, <span class="va">vTest</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">h1obs</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># repeat the comparison many times to generate a 95% confidence interval</span></span>
<span><span class="va">diffDist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span>, <span class="va">vTest</span>, <span class="va">nReps</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">testStatDist</span> <span class="op">&lt;-</span> <span class="fu">testDiff</span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span>, <span class="va">vTest</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nReps</span><span class="op">)</span></span>
<span>  <span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">testStatDist</span><span class="op">)</span></span>
<span>  <span class="va">ci95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="va">null95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">testStatDist</span>, <span class="va">ci95</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">null95</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lwrCI'</span>, <span class="st">'uprCI'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">null95</span>, <span class="st">'mean'</span> <span class="op">=</span> <span class="va">avg</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When we apply the boostrapping test, the results indicate a random
region of deep-water habitat contains more taxa with widespread ranges
than a proximal habitat two-thirds of the time. Assemblages of eurytopic
taxa from any random region almost always contained representatives with
more widespread ranges than assemblages of either habitat
specialist.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do deep-water environments harbor more cosmopolitan taxa?</span></span>
<span><span class="fu">diffDist</span><span class="op">(</span><span class="va">metaD</span>, <span class="va">metaP</span>, vTest <span class="op">=</span> <span class="st">'SCOR'</span>, nReps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     lwrCI     uprCI      mean </span></span>
<span><span class="co">#&gt; 0.6122449 0.6592347 0.6349163</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what about eurytopic taxa vs. deep-water specialists?</span></span>
<span><span class="fu">diffDist</span><span class="op">(</span><span class="va">metaE</span>, <span class="va">metaD</span>, vTest <span class="op">=</span> <span class="st">'SCOR'</span>, nReps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     lwrCI     uprCI      mean </span></span>
<span><span class="co">#&gt; 0.9755102 0.9938776 0.9844980</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># and if eurytopic species are more widespread than deep,</span></span>
<span><span class="co"># they'll also be more widespread than proximal-dwellers</span></span>
<span><span class="co"># (since more deep-water species are widespread than proximal are)</span></span>
<span><span class="fu">diffDist</span><span class="op">(</span><span class="va">metaE</span>, <span class="va">metaP</span>, vTest <span class="op">=</span> <span class="st">'SCOR'</span>, nReps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     lwrCI     uprCI      mean </span></span>
<span><span class="co">#&gt; 0.9816327 0.9979592 0.9894939</span></span></code></pre>
<p>Another way one could compare SCOR between groups is inspecting the
distribution of values in each comparison group. Overall, SCOR values
from assemblages of deep-water taxa were slightly larger than those of
proximal taxa, while eurytopic taxa were substantially more common than
either of those groups (SCOR values 4–5 times as large). Again, note
that because these results are derived from spatially standardised data,
these numbers account for the fact that eurytopic taxa as defined here
had many more cells of suitable habitat available to occupy.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">metaD</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   2.183   3.174   3.689   3.700   4.153   5.878</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">metaP</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   1.090   2.028   3.297   3.135   3.942   5.550</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">metaE</span><span class="op">$</span><span class="va">SCOR</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   3.383   9.796  15.042  14.959  19.822  28.715</span></span></code></pre>
<div class="section level3">
<h3 id="contrast-results-from-non-subsampled-data">Contrast results from non-subsampled data<a class="anchor" aria-label="anchor" href="#contrast-results-from-non-subsampled-data"></a>
</h3>
<p>What would the results and conclusions have been without going to the
effort to spatially subsample the original occurrence data? For
comparison with the average SCOR values listed above, the following code
uses the <code><a href="../reference/sdSumry.html">sdSumry()</a></code> function again, this time on the
non-standardised full datasets.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">deep</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist minSpanTree SCOR nTax</span></span>
<span><span class="co">#&gt; [1,]  713  250  -3192759  -1735760   166.32      33567.84       8071.8    130946.3    3   94</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">prox</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist minSpanTree SCOR nTax</span></span>
<span><span class="co">#&gt; [1,]  432  204  -3766508   -957619   166.32      33567.84      7845.98      127435 2.27   61</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdSumry.html">sdSumry</a></span><span class="op">(</span><span class="va">eury</span>, <span class="va">xyCell</span>, <span class="st">'genus'</span>, <span class="va">prj</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      nOcc nLoc centroidX centroidY latRange greatCircDist meanPairDist minSpanTree SCOR nTax</span></span>
<span><span class="co">#&gt; [1,] 3462  404  -3134553  -1227392   166.32      33567.84      8321.72    168862.1 9.46  100</span></span></code></pre>
<p>In this case the overall direction of results is the same (deep-water
taxa tend to be slightly more widespread than shallow-water taxa, and
eurytopic taxa are most widespread of all). However, subsampling makes
the difference between eurytopic taxa and specialists more
pronounced—SCOR values from raw data are estimated about three times
larger (rather than 4–5 times larger) compared to shallow- and
deep-water taxa.</p>
</div>
</div>
<div class="section level2">
<h2 id="average-taxon-range-size-between-environments">Average taxon range size between environments<a class="anchor" aria-label="anchor" href="#average-taxon-range-size-between-environments"></a>
</h2>
<p>The preceding section illustrates a way one might quantitatively
compare an ecological variable calculated from assemblage or community
data. There are many cases where one would be interested in a
taxon-specific variable instead, e.g. body size or other traits. The
present section demonstrates a way to extract and summarise focal taxon
data from subsampled assemblage data. The trait of interest in this
instance is geographic range size, which can be parameterised in a
variety of ways. The <code><a href="../reference/rangeSize.html">rangeSize()</a></code> function in
<code>divvy</code> returns five measures of geographic distribution, two
of which the following code compares between ecological study
groups.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># custom function to find all occurrences of focal taxon in a subsample</span></span>
<span><span class="co"># and return summary measures of geographic distribution from them</span></span>
<span><span class="va">subsampRange</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">taxa</span>, <span class="va">df</span>, <span class="va">taxCol</span>, <span class="va">coordCols</span>, <span class="va">crs</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">taxRange</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">taxon</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">taxBool</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="va">taxCol</span><span class="op">]</span> <span class="op">==</span> <span class="va">taxon</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">taxBool</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="co"># case where taxon unsampled</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">taxCoords</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">taxBool</span>, <span class="va">coordCols</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="../reference/rangeSize.html">rangeSize</a></span><span class="op">(</span><span class="va">taxCoords</span>, <span class="va">crs</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span></span>
<span>  <span class="va">rngMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">taxa</span>, <span class="va">taxRange</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">rngMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'occurrences'</span>, <span class="st">'centroidX'</span>, <span class="st">'centroidY'</span>, <span class="st">'latRange'</span>,</span>
<span>                        <span class="st">'greatCircDist'</span>, <span class="st">'meanPairDist'</span>, <span class="st">'minSpanTree'</span><span class="op">)</span></span>
<span>  <span class="va">rngDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="va">rngMat</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rngDf</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># run the function on all subsamples of each comparison set. warning:</span></span>
<span><span class="co"># these are intensive computations so might be slow (minutes of runtime)</span></span>
<span><span class="va">rngD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sampD</span>, FUN <span class="op">=</span> <span class="va">subsampRange</span>, taxa <span class="op">=</span> <span class="va">taxa</span>, taxCol <span class="op">=</span> <span class="st">'genus'</span>,</span>
<span>               coordCols <span class="op">=</span> <span class="va">xyCell</span>, crs <span class="op">=</span> <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">rngP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sampP</span>, FUN <span class="op">=</span> <span class="va">subsampRange</span>, taxa <span class="op">=</span> <span class="va">taxa</span>, taxCol <span class="op">=</span> <span class="st">'genus'</span>,</span>
<span>               coordCols <span class="op">=</span> <span class="va">xyCell</span>, crs <span class="op">=</span> <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">rngE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">sampE</span>, FUN <span class="op">=</span> <span class="va">subsampRange</span>, taxa <span class="op">=</span> <span class="va">taxa</span>, taxCol <span class="op">=</span> <span class="st">'genus'</span>,</span>
<span>               coordCols <span class="op">=</span> <span class="va">xyCell</span>, crs <span class="op">=</span> <span class="va">prj</span><span class="op">)</span></span></code></pre></div>
<p>The above code chunk produces a <code>list</code> of range-size data
for all genera in all subsamples. The lines below average all values for
each focal taxon to consolidate these intermediate calculations into
per-taxon range data for final analysis.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarize a focal species' range size data across all subsamples</span></span>
<span><span class="va">taxRange</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">rngL</span>, <span class="va">singletons</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">rngL</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">aBool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="va">a</span></span>
<span>    <span class="va">x</span><span class="op">[</span> <span class="va">aBool</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">aDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span>  <span class="co"># option: only consider subsamples where species is sampled multiple times</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">singletons</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">singl</span> <span class="op">&lt;-</span> <span class="va">aDf</span><span class="op">$</span><span class="va">occ</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>    <span class="va">aDf</span> <span class="op">&lt;-</span> <span class="va">aDf</span><span class="op">[</span> <span class="op">!</span><span class="va">singl</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">aDf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># apply summary function over all taxa in subsamples of preferred enviro</span></span>
<span><span class="va">rngAvgD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">taxaD</span>, <span class="va">taxRange</span>, rngL <span class="op">=</span> <span class="va">rngD</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rngAvgP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">taxaP</span>, <span class="va">taxRange</span>, rngL <span class="op">=</span> <span class="va">rngP</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rngAvgE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">taxaE</span>, <span class="va">taxRange</span>, rngL <span class="op">=</span> <span class="va">rngE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>There are cases where a taxon is observed only once in a given
subsample, which is uninformative for any geographic range measure
except raw occurrence counts. The custom argument
<code>singletons = FALSE</code> omits these cases from consideration for
the focal taxon range-size average.</p>
<p>Some taxa are never observed multiple times even with many
subsamples. After omitting these taxa, the sample size of genera in each
comparison group shrinks to 43 in deep water, 24 in proximal habitats,
and 95 occupying a breadth of depths.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rngAvgD</span> <span class="op">&lt;-</span> <span class="va">rngAvgD</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">rngAvgD</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">rngAvgP</span> <span class="op">&lt;-</span> <span class="va">rngAvgP</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">rngAvgP</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">rngAvgE</span> <span class="op">&lt;-</span> <span class="va">rngAvgE</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'D'</span> <span class="op">=</span> <span class="va">rngAvgD</span>, <span class="st">'P'</span> <span class="op">=</span> <span class="va">rngAvgP</span>, <span class="st">'E'</span> <span class="op">=</span> <span class="va">rngAvgE</span><span class="op">)</span>, <span class="va">nrow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  D  P  E </span></span>
<span><span class="co">#&gt; 43 24 95</span></span></code></pre>
<p>The previous section, assessing SCOR as an example of comparing
assemblage-based metrics, demonstrated a bootstrapping approach to
generate results. As a complementary example, the following chunk uses
Frequentist two-sample tests to address each hypothesis. For simplicity,
only two measure of geographic range are compared here (grid cell
occupancy and summed length of minimum spanning tree); the reader could
easily substitute any of the other three in the datasets (latitudinal
range, great circle distance, and mean pairwise distance).</p>
<p>The occurrence or occupancy measure of range size is count data, so a
Wilcoxon (Mann-Whitney) test is appropriate as a nonparametric test. The
second range-size metric, summed length of minimum spanning tree,
follows a normal distribution after square-root transformation; a
student’s t-test makes parametric comparisons on it.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">rngAvgD</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">rngAvgP</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># deep vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning in wilcox.test.default(rngAvgD$occurrences, rngAvgP$occurrences, : cannot compute exact p-value with ties</span></span></code></pre>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgD$occurrences and rngAvgP$occurrences</span></span>
<span><span class="co">#&gt; W = 538, p-value = 0.3876</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">rngAvgD</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs deep</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgE$occurrences and rngAvgD$occurrences</span></span>
<span><span class="co">#&gt; W = 2794, p-value = 0.0002696</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">rngAvgP</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgE$occurrences and rngAvgP$occurrences</span></span>
<span><span class="co">#&gt; W = 1603, p-value = 0.001076</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rngAvgD</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rngAvgD</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="va">rngAvgP</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rngAvgP</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">rngAvgD</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">rngAvgP</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># deep vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgD$minSpanTree and rngAvgP$minSpanTree</span></span>
<span><span class="co">#&gt; t = 0.10779, df = 38.352, p-value = 0.4574</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -3.728928       Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;  26.92918  26.67442</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">rngAvgD</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs deep</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgE$minSpanTree and rngAvgD$minSpanTree</span></span>
<span><span class="co">#&gt; t = 3.153, df = 82.129, p-value = 0.001129</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  2.119235      Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;  31.41559  26.92918</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">rngAvgE</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">rngAvgD</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  rngAvgE$minSpanTree and rngAvgD$minSpanTree</span></span>
<span><span class="co">#&gt; t = 3.153, df = 82.129, p-value = 0.001129</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  2.119235      Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;  31.41559  26.92918</span></span></code></pre>
<p>The results of per-taxon range size comparisons are less clear than
those of assemblage-based SCOR comparisons above. There is no
discernible difference in mean range size between deep- and
shallow-water species whether measured as occurrence counts or minimum
spanning tree distances. However, eurytopic taxa still measure larger
than either specialist group, even by conservative thresholds for
significance: eurytopic taxa occur in nearly one more grid cell of the
15 in every subsample, and span about 270 km farther in tree length
connecting occupied cells. (Recall the tree lengths printed here are
square-root transformed.)</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'occurrences'</span>, <span class="st">'minSpanTree'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'D'</span> <span class="op">=</span> <span class="va">rngAvgD</span>, <span class="st">'P'</span> <span class="op">=</span> <span class="va">rngAvgP</span>, <span class="st">'E'</span> <span class="op">=</span> <span class="va">rngAvgE</span><span class="op">)</span>,</span>
<span>       <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="va">vars</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>       <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                     D         P        E</span></span>
<span><span class="co">#&gt; occurrences  2.863038  2.898537  3.66210</span></span>
<span><span class="co">#&gt; minSpanTree 26.929182 26.674421 31.41559</span></span></code></pre>
<div class="section level3">
<h3 id="contrast-results-from-non-subsampled-data-1">Contrast results from non-subsampled data<a class="anchor" aria-label="anchor" href="#contrast-results-from-non-subsampled-data-1"></a>
</h3>
<p>As with the assemblage-based analysis above, we can investigate the
inferences that would have resulted from analysing the original
occurrence data, without subsampling.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate geographic range size on alloccurrences (not subsampled)</span></span>
<span><span class="va">unsamp</span> <span class="op">&lt;-</span> <span class="fu">subsampRange</span><span class="op">(</span><span class="va">taxa</span>, df <span class="op">=</span> <span class="va">occSilur</span>, taxCol <span class="op">=</span> <span class="st">'genus'</span>, coordCols <span class="op">=</span> <span class="va">xyCell</span>, crs <span class="op">=</span> <span class="va">prj</span><span class="op">)</span></span>
<span><span class="va">unsampD</span> <span class="op">&lt;-</span> <span class="va">unsamp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">unsamp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">taxaD</span>,<span class="op">]</span></span>
<span><span class="va">unsampP</span> <span class="op">&lt;-</span> <span class="va">unsamp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">unsamp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">taxaP</span>,<span class="op">]</span></span>
<span><span class="va">unsampE</span> <span class="op">&lt;-</span> <span class="va">unsamp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">unsamp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">taxaE</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">unsampD</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">unsampP</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># deep vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampD$occurrences and unsampP$occurrences</span></span>
<span><span class="co">#&gt; W = 2778, p-value = 0.6299</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">unsampE</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">unsampD</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs deep</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampE$occurrences and unsampD$occurrences</span></span>
<span><span class="co">#&gt; W = 7878, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">unsampE</span><span class="op">$</span><span class="va">occurrences</span>, <span class="va">unsampP</span><span class="op">$</span><span class="va">occurrences</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampE$occurrences and unsampP$occurrences</span></span>
<span><span class="co">#&gt; W = 5177.5, p-value = 5.463e-14</span></span>
<span><span class="co">#&gt; alternative hypothesis: true location shift is greater than 0</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsampE</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">unsampE</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="va">unsampD</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">unsampD</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="va">unsampP</span><span class="op">$</span><span class="va">minSpanTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">unsampP</span><span class="op">$</span><span class="va">minSpanTree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">unsampD</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">unsampP</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># deep vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampD$minSpanTree and unsampP$minSpanTree</span></span>
<span><span class="co">#&gt; t = 1.4578, df = 128.32, p-value = 0.07368</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  -2.172339       Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt; 105.78370  89.87555</span></span></code></pre>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">unsampE</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">unsampD</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs deep</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampE$minSpanTree and unsampD$minSpanTree</span></span>
<span><span class="co">#&gt; t = 5.5061, df = 169.6, p-value = 6.687e-08</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  41.22068      Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;  164.7019  105.7837</span></span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">unsampE</span><span class="op">$</span><span class="va">minSpanTree</span>, <span class="va">unsampD</span><span class="op">$</span><span class="va">minSpanTree</span>, alternative<span class="op">=</span><span class="st">'g'</span><span class="op">)</span> <span class="co"># eurytopic vs shallow</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  unsampE$minSpanTree and unsampD$minSpanTree</span></span>
<span><span class="co">#&gt; t = 5.5061, df = 169.6, p-value = 6.687e-08</span></span>
<span><span class="co">#&gt; alternative hypothesis: true difference in means is greater than 0</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  41.22068      Inf</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; mean of x mean of y </span></span>
<span><span class="co">#&gt;  164.7019  105.7837</span></span></code></pre>
<p>In the bootstrapped analysis of SCOR values, subsampling happened to
amplify the differences between comparison groups. In the Frequentist
analysis of per-taxon range size in this section, subsampling reduced
the quantitative magnitude of differences between comparison groups. To
some extent, this muting of absolute differences makes sense given the
inherent truncation of geographic ranges due to subsampling. However,
looking back at the <a href="#raster_map">map of PBDB data
distribution</a>, it is also possible to hypothesise that biased
sampling artificially inflated group differences. For instance, as noted
when plotting the map, sampling coverage of deep-water habitats extends
much farther around Laurasia compared to shallow-water habitats. Without
accounting for this influence, it is impossible to attribute the greater
minimum spanning tree length of deep-water species to ecology alone.
After subsampling, although there may be fewer results that are clear,
the analyst can trust the results that do emerge as meaningful for
biological interpretation.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Allmon2014" class="csl-entry">
Allmon, Warren D, and Ronald E Martin. 2014. <span>“Seafood Through Time
Revisited: The Phanerozoic Increase in Marine Trophic Resources and Its
Macroevolutionary Consequences.”</span> Journal Article.
<em>Paleobiology</em> 40 (2): 256–87.
</div>
<div id="ref-Antell2023" class="csl-entry">
Antell, Gawain T, Roger BJ Benson, and Erin E Saupe. accepted.
<span>“Spatial Standardization of Taxon Occurrence Data—a Call to
Action.”</span> Journal Article. <em>Paleobiology</em>, accepted. <a href="https://doi.org/10.31223/X5997Z" class="external-link">https://doi.org/10.31223/X5997Z</a>.
</div>
<div id="ref-Antell2020" class="csl-entry">
Antell, Gawain T, Wolfgang Kiessling, Martin Aberhan, and Erin E Saupe.
2020. <span>“Marine Biodiversity and Geographic Distributions Are
Independent on Large Scales.”</span> Journal Article. <em>Current
Biology</em> 30 (1): 115–21.
</div>
<div id="ref-Close2020" class="csl-entry">
Close, Roger A, Roger BJ Benson, Erin E Saupe, Michael E Clapham, and
Richard J Butler. 2020. <span>“The Spatial Structure of Phanerozoic
Marine Animal Diversity.”</span> Journal Article. <em>Science</em> 368
(6489): 420–24.
</div>
<div id="ref-Close2017" class="csl-entry">
Close, Roger A, Roger BJ Benson, Paul Upchurch, and Richard J Butler.
2017. <span>“Controlling for the Species-Area Effect Supports
Constrained Long-Term Mesozoic Terrestrial Vertebrate
Diversification.”</span> <em>Nature Communications</em> 8 (1): 15381.
</div>
<div id="ref-Coe1946" class="csl-entry">
Coe, Wesley R. 1946. <span>“The Means of Dispersal of Bathypelagic
Animals in the North and South Atlantic Oceans.”</span> Journal Article.
<em>The American Naturalist</em> 80 (793): 453–69.
</div>
<div id="ref-Costello2017" class="csl-entry">
Costello, Mark J, and Chhaya Chaudhary. 2017. <span>“Marine
Biodiversity, Biogeography, Deep-Sea Gradients, and
Conservation.”</span> Journal Article. <em>Current Biology</em> 27 (11):
R511–27.
</div>
<div id="ref-Duran2018" class="csl-entry">
Durán, Ruth, and Jorge Guillén. 2018. <span>“Continental Shelf
Landforms.”</span> In <em>Submarine Geomorphology</em>, edited by Aaron
Micallef, Sebastian Krastel, and Alessandra Savini, 185–206. Springer.
</div>
<div id="ref-fossilbrush" class="csl-entry">
Flannery-Sutherland, Joe, Nussaïbah Raja-Schoob, Ádam Kocsis, and
Wolfgang Kiessling. 2022. <em>Fossilbrush: Automated Cleaning of Fossil
Occurrence Data</em>. <a href="https://CRAN.R-project.org/package=fossilbrush" class="external-link">https://CRAN.R-project.org/package=fossilbrush</a>.
</div>
<div id="ref-Gaston2003" class="csl-entry">
Gaston, Kevin J. 2003. <em>The Structure and Dynamics of Geographic
Ranges</em>. Book. Oxford University Press.
</div>
<div id="ref-Hannisdal2012" class="csl-entry">
Hannisdal, Bjarte, Jorijntje Henderiks, and Lee Hsiang Liow. 2012.
<span>“Long-Term Evolutionary and Ecological Responses of Calcifying
Phytoplankton to Changes in Atmospheric CO2.”</span> <em>Global Change
Biology</em> 18 (12): 3504–16.
</div>
<div id="ref-Hansen1980" class="csl-entry">
Hansen, Thor A. 1980. <span>“Influence of Larval Dispersal and
Geographic Distribution on Species Longevity in Neogastropods.”</span>
Journal Article. <em>Paleobiology</em>, 193–207.
</div>
<div id="ref-Harnik2012" class="csl-entry">
Harnik, Paul G, Carl Simpson, and Jonathan L Payne. 2012.
<span>“Long-Term Differences in Extinction Risk Among the Seven Forms of
Rarity.”</span> Journal Article. <em>Proceedings of the Royal Society B:
Biological Sciences</em> 279 (1749): 4969–76.
</div>
<div id="ref-Jablonski2003" class="csl-entry">
Jablonski, David, and Kaustuv Roy. 2003. <span>“Geographical Range and
Speciation in Fossil and Living Molluscs.”</span> Journal Article.
<em>Proceedings of the Royal Society B: Biological Sciences</em> 270
(1513): 401–6.
</div>
<div id="ref-Maurer2001" class="csl-entry">
Maurer, Brian A, and M Philip Nott. 2001. <span>“Geographic Range
Fragmentation and the Evolution of Biological Diversity.”</span> Book
Section. In <em>Biodiversity Dynamics</em>, edited by Michael L McKinney
and James A Drake, 31–50. Columbia University Press.
</div>
<div id="ref-McClain2010" class="csl-entry">
McClain, Craig R, and Sarah Mincks Hardy. 2010. <span>“The Dynamics of
Biogeographic Ranges in the Deep Sea.”</span> Journal Article.
<em>Proceedings of the Royal Society B: Biological Sciences</em> 277
(1700): 3533–46.
</div>
<div id="ref-Nurnberg2013" class="csl-entry">
Nürnberg, Sabine, and Martin Aberhan. 2013. <span>“Habitat Breadth and
Geographic Range Predict Diversity Dynamics in Marine Mesozoic
Bivalves.”</span> Journal Article. <em>Paleobiology</em> 39 (3): 360–72.
</div>
<div id="ref-Rojas2021" class="csl-entry">
Rojas, Alexis, Joaquin Calatayud, Michał Kowalewski, Magnus Neuman, and
Martin Rosvall. 2021. <span>“A Multiscale View of the Phanerozoic Fossil
Record Reveals the Three Major Biotic Transitions.”</span>
<em>Communications Biology</em> 4 (1): 1–8.
</div>
<div id="ref-Rosenzweig1995" class="csl-entry">
Rosenzweig, Michael L. 1995. <em>Species Diversity in Space and
Time</em>. Book. Cambridge University Press.
</div>
<div id="ref-Saupe2015" class="csl-entry">
Saupe, Erin E, Huijie Qiao, Jonathan R Hendricks, Roger W Portell,
Stephen J Hunter, Jorge Soberón, and Bruce S Lieberman. 2015.
<span>“Niche Breadth and Geographic Range Size as Determinants of
Species Survival on Geological Time Scales.”</span> Journal Article.
<em>Global Ecology and Biogeography</em> 24 (10): 1159–69.
</div>
<div id="ref-Scotese2016" class="csl-entry">
Scotese, Christopher R. 2016. <span>“PALEOMAP PaleoAtlas for GPlates and
the PaleoData Plotter Program.”</span> <a href="https://www.earthbyte.org/webdav/ftp/earthbyte/Scotese_PaleoAtlas_v3.zip" class="external-link">https://www.earthbyte.org/webdav/ftp/earthbyte/Scotese_PaleoAtlas_v3.zip</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gawain Antell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
