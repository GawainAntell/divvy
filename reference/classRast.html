<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Given point occurrences of environmental categories, classRast generates
a raster grid with cell values specifying the majority environment therein."><title>Convert point environment data to a raster of majority-environment classes — classRast • divvy</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert point environment data to a raster of majority-environment classes — classRast"><meta property="og:description" content="Given point occurrences of environmental categories, classRast generates
a raster grid with cell values specifying the majority environment therein."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">divvy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/subsampling-vignette.html">Subsampling tutorial</a>
    <a class="dropdown-item" href="../articles/habitat-rangesize-case-study.html">Range size case study</a>
    <a class="dropdown-item" href="../articles/subsampling-concept-walkthrough.html">Conceptual walkthrough</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GawainAntell/divvy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Convert point environment data to a raster of majority-environment classes</h1>
      <small class="dont-index">Source: <a href="https://github.com/GawainAntell/divvy/blob/HEAD/R/calc_enviro_variables.R" class="external-link"><code>R/calc_enviro_variables.R</code></a></small>
      <div class="d-none name"><code>classRast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given point occurrences of environmental categories, <code>classRast</code> generates
a raster grid with cell values specifying the majority environment therein.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">classRast</span><span class="op">(</span><span class="va">grid</span>, dat <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">xy</span>, <span class="va">env</span>, <span class="va">cutoff</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>grid</dt>
<dd><p>A <code>SpatRaster</code> to use as a template for the
resolution, extent, and coordinate reference system of the returned object.
Values can be empty.</p></dd>


<dt>dat</dt>
<dd><p>Either a <code>data.frame</code> or <code>matrix</code> for which <code>xy</code> and <code>env</code> are
column names, or an empty argument.</p></dd>


<dt>xy</dt>
<dd><p>A vector specifying the name or numeric position of columns
in <code>dat</code> containing coordinates, if <code>dat</code> is supplied, or a 2-column
<code>data.frame</code> or <code>matrix</code> of coordinate values.</p></dd>


<dt>env</dt>
<dd><p>The name or numeric position of the column in <code>dat</code> containing a
categorical environmental variable, if <code>dat</code> is supplied, or a vector of
environmental values.</p></dd>


<dt>cutoff</dt>
<dd><p>The (decimal) proportion of incidences of an environmental
category above which a cell will be assigned as that category.
<code>cutoff</code> must be greater than 0.5.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A raster of class <code>SpatRaster</code> defined by the <code>terra</code> package</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>cutoff</code> threshold is an inclusive bound: environmental incidence
proportions greater than or equal to the <code>cutoff</code> will assign cell values
to the majority environmental class. For instance, if category A represents
65% of occurrences in a cell and <code>cutoff = 0.65</code>, the returned value for the
cell will be A. If no single category in a cell meets or exceeds the
representation necessary to reach the given <code>cutoff</code>, the value returned
for the cell is <code>indet.</code>, indeterminate.
Cells lacking environmental occurrences altogether return <code>NA</code> values.</p>
<p>The <code>env</code> object can contain more than two classes, but in many cases it will
be less likely for any individual class to attain an absolute majority the
more finely divided classes are. For example, if there are three classes,
A, B, and C, with relative proportions of 20%, 31%, and 49%, the cell value
will be returned as <code>indet.</code> because no single class can attain a <code>cutoff</code>
above 50%, despite class C having the largest relative representation.</p>
<p>Missing environment values in the point data should be coded as <code>NA</code>,
not e.g. <code>'unknown'</code>. <code>classRast()</code> ignores <code>NA</code> occurrences when tallying
environmental occurrences against the <code>cutoff</code>. However, <code>NA</code> occurrences
still count when determining <code>NA</code> status of cells in the raster: a cell
containing occurrences of only <code>NA</code> value is classified as <code>indet.</code>, not <code>NA</code>.
That is, any grid cell encompassing original point data is non-<code>NA</code>.</p>
<p>Antell and others (2020) set a <code>cutoff</code> of 0.8, based on the same threshold
Nürnberg and Aberhan (2013) used to classify environmental preferences for taxa.</p>
<p>The coordinates associated with points should be given with respect to the
same coordinate reference system (CRS) of the target raster grid, e.g. both
given in latitude-longitude, Equal Earth projected coordinates, or other CRS.
The CRS of a <code>SpatRaster</code> object can be retrieved with <code><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">terra::crs()</a></code>
(with the optional but helpful argument <code>describe = TRUE</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Antell GT, Kiessling W, Aberhan M, Saupe EE (2020).
“Marine biodiversity and geographic distributions are independent on large scales.”
<em>Current Biology</em>, <b>30</b>(1), 115-121.
<a href="https://doi.org/10.1016/j.cub.2019.10.065" class="external-link">doi:10.1016/j.cub.2019.10.065</a>
.</p>
<p>Nürnberg S, Aberhan M (2013).
“Habitat breadth and geographic range predict diversity dynamics in marine Mesozoic bivalves.”
<em>Paleobiology</em>, <b>39</b>(3), 360-372.
<a href="https://doi.org/10.1666/12047" class="external-link">doi:10.1666/12047</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># work in Equal Earth projected coordinates</span></span></span>
<span class="r-in"><span><span class="va">prj</span> <span class="op">&lt;-</span> <span class="st">'EPSG:8857'</span></span></span>
<span class="r-in"><span><span class="co"># generate point occurrences in a small area of Northern Africa</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,  <span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># generate an environmental variable with a latitudinal gradient</span></span></span>
<span class="r-in"><span><span class="co"># more habitat type 0 (e.g. rock) near equator, more 1 (e.g. grassland) to north</span></span></span>
<span class="r-in"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">env</span><span class="op">[</span><span class="va">env</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'rock'</span></span></span>
<span class="r-in"><span><span class="va">env</span><span class="op">[</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'grass'</span></span></span>
<span class="r-in"><span><span class="co"># units for Equal Earth are meters, so if we consider x and y as given in km,</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">ptsDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">env</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># raster for study area at 5-km resolution</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span>resolution <span class="op">=</span> <span class="fl">5</span><span class="op">*</span><span class="fl">1000</span>, crs <span class="op">=</span> <span class="va">prj</span>,</span></span>
<span class="r-in"><span>          xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">30000</span>, ymin <span class="op">=</span> <span class="fl">10000</span>, ymax <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">binRast</span> <span class="op">&lt;-</span> <span class="fu">classRast</span><span class="op">(</span>grid <span class="op">=</span> <span class="va">r</span>, dat <span class="op">=</span> <span class="va">ptsDf</span>, xy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     env <span class="op">=</span> <span class="st">'env'</span>, cutoff <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">binRast</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 4, 6, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 5000, 5000  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 0, 30000, 10000, 30000  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : +proj=eqearth +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> categories  : mainClass </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        : mainClass </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   :     grass </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :    indet. </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot environment classification vs. original points</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">binRast</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lightgreen'</span>, <span class="st">'grey60'</span>, <span class="st">'white'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">ptsDf</span><span class="op">[</span><span class="va">env</span><span class="op">==</span><span class="st">'rock'</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="co"># occurrences of given habitat</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">ptsDf</span><span class="op">[</span><span class="va">env</span><span class="op">==</span><span class="st">'grass'</span>,<span class="op">]</span>, pch <span class="op">=</span>  <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="classRast-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># classRast can also accept more than 2 environmental classes:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add a 3rd environmental class with maximum occurrence in bottom-left grid cell</span></span></span>
<span class="r-in"><span><span class="va">newEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">'x'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,       <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     <span class="st">'y'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10000</span>,   <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     <span class="st">'env'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'new'</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ptsDf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ptsDf</span>, <span class="va">newEnv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">binRast</span> <span class="op">&lt;-</span> <span class="fu">classRast</span><span class="op">(</span>grid <span class="op">=</span> <span class="va">r</span>, dat <span class="op">=</span> <span class="va">ptsDf</span>, xy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     env <span class="op">=</span> <span class="st">'env'</span>, cutoff <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">binRast</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lightgreen'</span>, <span class="st">'grey60'</span>, <span class="st">'purple'</span>, <span class="st">'white'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="classRast-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Gawain Antell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

