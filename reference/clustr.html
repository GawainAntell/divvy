<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Spatially subsample a dataset based on minimum spanning trees connecting
points within regions of set extent, with optional rarefaction to a site quota."><title>Cluster localities within regions of nearest neighbours — clustr • divvy</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cluster localities within regions of nearest neighbours — clustr"><meta property="og:description" content="Spatially subsample a dataset based on minimum spanning trees connecting
points within regions of set extent, with optional rarefaction to a site quota."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">divvy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/subsampling-vignette.html">Subsampling tutorial</a>
    <a class="dropdown-item" href="../articles/habitat-rangesize-case-study.html">Range size case study</a>
    <a class="dropdown-item" href="../articles/subsampling-concept-walkthrough.html">Conceptual walkthrough</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GawainAntell/divvy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cluster localities within regions of nearest neighbours</h1>
      <small class="dont-index">Source: <a href="https://github.com/GawainAntell/divvy/blob/HEAD/R/subsample_MST.R" class="external-link"><code>R/subsample_MST.R</code></a></small>
      <div class="d-none name"><code>clustr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Spatially subsample a dataset based on minimum spanning trees connecting
points within regions of set extent, with optional rarefaction to a site quota.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clustr</span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  <span class="va">xy</span>,</span>
<span>  <span class="va">iter</span>,</span>
<span>  nSite <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">distMax</span>,</span>
<span>  nMin <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"epsg:4326"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"locs"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dat</dt>
<dd><p>A <code>data.frame</code> or <code>matrix</code> containing the coordinate
columns <code>xy</code> and any associated variables, e.g. taxon names.</p></dd>


<dt>xy</dt>
<dd><p>A vector of two elements, specifying the name or numeric position
of columns in <code>dat</code> containing coordinates, e.g. longitude and latitude.
Coordinates for any shared sampling sites should be identical, and where sites
are raster cells, coordinates are usually expected to be cell centroids.</p></dd>


<dt>iter</dt>
<dd><p>The number of spatial subsamples to return</p></dd>


<dt>nSite</dt>
<dd><p>The quota of unique locations to include in each subsample.</p></dd>


<dt>distMax</dt>
<dd><p>Numeric value for maximum diameter (km) allowed across
locations in a subsample</p></dd>


<dt>nMin</dt>
<dd><p>Numeric value for the minimum number of sites to be included in
every returned subsample. If <code>nSite</code> supplied, <code>nMin</code> ignored.</p></dd>


<dt>crs</dt>
<dd><p>Coordinate reference system as a GDAL text string, EPSG code,
or object of class <code>crs</code>. Default is latitude-longitude (<code>EPSG:4326</code>).</p></dd>


<dt>output</dt>
<dd><p>Whether the returned data should be two columns of
subsample site coordinates (<code>output = 'locs'</code>) or the subset of rows
from <code>dat</code> associated with those coordinates (<code>output = 'full'</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of length <code>iter</code>. Each element is a <code>data.frame</code></p>


<p>(or <code>matrix</code>, if <code>dat</code> is a <code>matrix</code> and <code>output = 'full'</code>).
If <code>nSite</code> is supplied, each element contains <code>nSite</code> observations.
If <code>output = 'locs'</code> (default), only the coordinates of subsampling
locations are returned.
If <code>output = 'full'</code>, all <code>dat</code> columns are returned for the
rows associated with the subsampled locations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Lagomarcino and Miller (2012) developed an iterative approach of aggregating
localities to build clusters based on convex hulls, inspired by species-area
curve analysis (Scheiner 2003). Close et al. (2017, 2020) refined the approach and
changed the proximity metric from minimum convex hull area to minimum spanning
tree length. The present implementation adapts code from Close et al. (2020)
to add an option for site rarefaction after cluster construction and to grow
trees at random starting points <code>iter</code> number of times (instead of a
deterministic, exhaustive iteration at every unique location).</p>
<p>The function takes a single location as a starting (seed) point; the seed
and its nearest neighbour initiate a spatial cluster. The distance between
the two points is the first branch in a minimum spanning tree for the cluster.
The location that has the shortest distance to any points already within the
cluster is grouped in next, and its distance (branch) is added to the sum
tree length. This iterative process continues until the largest distance
between any two points in the cluster would exceed <code>distMax</code> km.
In the rare case multiple candidate points are tied for minimum distance
from the cluster, one point is selected at random as the next to include.
Any tree with fewer than <code>nMin</code> points is prohibited.</p>
<p>In the case that <code>nSite</code> is supplied, <code>nMin</code> argument is ignored,
and any tree with fewer than <code>nSite</code> points is prohibited.
After building a tree as described above, a random set of <code>nSite</code> points
within the cluster is taken (without replacement).
The <code>nSite</code> argument makes <code>clustr()</code> comparable with <code><a href="cookies.html">cookies()</a></code>
in that it spatially standardises both extent and area/locality number.</p>
<p>The performance of <code>clustr()</code> is designed on the assumption <code>iter</code>
is much larger than the number of unique localities. Internal code first
calculates the full minimum spanning tree at every viable starting point
before it then samples those trees (i.e. resamples and optionally rarefies)
for the specified number of iterations. This sequence means the total
run-time increases only marginally even as <code>iter</code> increases greatly.
However, if there are a large number of sites, particularly a large number
of densely-spaced sites, the calculations will be slow even for a
small number of iterations.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Antell GT, Kiessling W, Aberhan M, Saupe EE (2020).
“Marine biodiversity and geographic distributions are independent on large scales.”
<em>Current Biology</em>, <b>30</b>(1), 115-121.
<a href="https://doi.org/10.1016/j.cub.2019.10.065" class="external-link">doi:10.1016/j.cub.2019.10.065</a>
.</p>
<p>Close RA, Benson RB, Upchurch P, Butler RJ (2017).
“Controlling for the species--area effect supports constrained long-term Mesozoic terrestrial vertebrate diversification.”
<em>Nature Communications</em>, <b>8</b>(1), 1--11.
<a href="https://doi.org/10.1038/ncomms15381" class="external-link">doi:10.1038/ncomms15381</a>
.</p>
<p>Close RA, Benson RB, Saupe EE, Clapham ME, Butler RJ (2020).
“The spatial structure of Phanerozoic marine animal diversity.”
<em>Science</em>, <b>368</b>(6489), 420-424.
<a href="https://doi.org/10.1126/science.aay8309" class="external-link">doi:10.1126/science.aay8309</a>
.</p>
<p>Lagomarcino AJ, Miller AI (2012).
“The relationship between genus richness and geographic area in Late Cretaceous marine biotas: Epicontinental sea versus open-ocean-facing settings.”
<em>PloS One</em>, <b>7</b>(8), e40472.
<a href="https://doi.org/10.1371/journal.pone.0040472" class="external-link">doi:10.1371/journal.pone.0040472</a>
.</p>
<p>Scheiner SM (2003).
“Six types of species--area curves.”
<em>Global Ecology and Biogeography</em>, <b>12</b>(6), 441-447.
<a href="https://doi.org/10.1046/j.1466-822X.2003.00061.x" class="external-link">doi:10.1046/j.1466-822X.2003.00061.x</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="cookies.html">cookies()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># generate occurrences: 10 lat-long points in modern Australia</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">140</span>, to <span class="op">=</span> <span class="fl">145</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="op">-</span><span class="fl">25</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sample 5 sets of 4 locations no more than 400km across</span></span></span>
<span class="r-in"><span><span class="fu">clustr</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">pts</span>, xy <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>       nSite <span class="op">=</span> <span class="fl">4</span>, distMax <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 145.0000 -25.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  143.8889 -23.88889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  144.4444 -24.44444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  142.7778 -22.77778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          x         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 141.1111 -21.11111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 142.2222 -22.22222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 141.6667 -21.66667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 140.5556 -20.55556</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  142.7778 -22.77778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 145.0000 -25.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  143.3333 -23.33333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  143.8889 -23.88889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          x         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 143.8889 -23.88889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 141.6667 -21.66667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 143.3333 -23.33333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 142.7778 -22.77778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           x         y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  143.3333 -23.33333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 145.0000 -25.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  144.4444 -24.44444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  143.8889 -23.88889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Gawain Antell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

